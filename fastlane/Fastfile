default_platform(:ios)

platform :ios do
  desc "Build and export ipa"
  lane :export_ipa do
    # ปลดล็อก keychain ที่เก็บ certificate
    unlock_keychain(
      path: ENV['KEYCHAIN_PATH'] || "~/Library/Keychains/login.keychain-db",
      password: ENV['KEYCHAIN_PASSWORD'] || "ibusiness"
    )

    # อัปเดตการตั้งค่า code signing (ถ้าจำเป็น)
    update_code_signing_settings(
      use_automatic_signing: false,
      path: ENV['PROJECT_PATH'] || "ios/FinderUK.xcodeproj"
    )

    # รัน build app (ปรับ scheme/workspace ตามโปรเจกต์คุณ)
    build_app(
      scheme: ENV['SCHEME'] || "FinderUK",
      workspace: ENV['WORKSPACE_PATH'] || "ios/FinderUK.xcworkspace",
      export_method: ENV['EXPORT_METHOD'] || "app-store",
      output_directory: "./build",
      output_name: "FinderUK.ipa"
    )
  end
end